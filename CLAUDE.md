# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Weave Cash is a **crypto-to-crypto payment platform**. Merchants set what crypto they want to receive; customers pay in whatever crypto they have. The conversion happens invisibly.

**Important:** This is crypto-to-crypto only. No fiat currencies (USD, EUR, etc.).

**Repository:** https://github.com/AryanJ-NYC/weave-cash

## Commands

```bash
# Install dependencies
pnpm install

# Development (starts all apps)
pnpm dev

# Build all packages
pnpm build

# Linting and formatting
pnpm lint
pnpm format

# Type checking
pnpm check-types

# Database commands (run from packages/database)
pnpm db:generate    # Generate Prisma client
pnpm db:migrate     # Create and apply migrations
pnpm db:push        # Push schema without migrations
pnpm db:studio      # Open Prisma Studio

# Start PostgreSQL for local dev
docker-compose up
```

## Architecture

```
weave-cash/
├── apps/web/                 # Next.js 16 frontend (App Router, React 19)
├── packages/
│   ├── database/             # Prisma schema and client
│   ├── eslint-config/        # Shared ESLint configs
│   ├── tailwind-config/      # Shared Tailwind config
│   └── typescript-config/    # Shared TS configs
```

### Key Technologies
- **Frontend:** Next.js 16, React 19, Tailwind CSS 4, shadcn/ui
- **Auth:** Better Auth with 2FA support
- **Database:** PostgreSQL 16 via Prisma ORM
- **Package Manager:** pnpm 9.0.0+

### Authentication Flow
- Server config: `apps/web/lib/auth.ts`
- Client utilities: `apps/web/lib/auth-client.ts`
- Route protection: `apps/web/proxy.ts` (Next.js 16 renamed middleware → proxy)
- Auth API: `/api/auth/[...all]`

**Auth Routes:**
- `/login` - Email/password sign in
- `/register` - Email/password registration
- `/two-factor` - TOTP verification during login
- `/settings/security` - 2FA setup (QR code, backup codes)

**Route Groups:**
- `(auth)` - Public auth pages (login, register, two-factor)
- `(app)` - Protected pages (dashboard, settings)

### Environment Variables
Validated via `@t3-oss/env-nextjs` in `apps/web/lib/env.ts`:
- `DATABASE_URL` - PostgreSQL connection string
- `BETTER_AUTH_SECRET` - Auth secret key
- `BETTER_AUTH_URL` - Auth callback URL
- `NEXT_PUBLIC_BETTER_AUTH_URL` - Client-side auth URL

## Issue Tracking

This project uses **GitHub Issues**. Use the `gh` CLI:

```bash
gh issue create --title "Title" --body "Description"
gh issue list
gh issue view <number>
```

## Code Conventions

- **Types over interfaces:** Use `type` aliases, not `interface`
- **Newspaper pattern:** Main exports at top, types at bottom of file
- **clsx import:** Use `import { clsx } from 'clsx'` (not `'clsx/lite'` — `clsx/lite` only accepts strings, breaking shadcn's `cn()` which passes objects)
- **Path aliases:** `@/` maps to current app directory
- **Never modify shadcn base components:** Files in `components/ui/` are generated by shadcn. Override styles via `className` props at the call site, never by editing the base component files.

### shadcn/ui Configuration
Initialized with `cssVariables: false` flag and neutral base color. Components use hardcoded Tailwind color classes (e.g., `bg-neutral-100`, `dark:bg-neutral-800`) instead of CSS variables. Dark mode uses `prefers-color-scheme` media query via Tailwind's `dark:` variant.

## Prisma Note

Prisma resolves `.env` relative to `prisma/schema.prisma`. For database commands, either run from `packages/database` directory or prefix with `DATABASE_URL="..."`.
